<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updates - Short Crisp News</title>
    
    <!-- Favicon and Icons -->
    <link rel="icon" href="image-2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-meta: #888888;
            --header-gradient-1: #3b82f6;
            --header-gradient-2: #2563eb;
            --border-color: #e5e7eb;
            --accent-color: #3b82f6;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.10);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        [data-theme="dark"] {
            --bg-color: #0f0f0f;
            --card-bg: #1a1a1a;
            --text-primary: #f0f0f0;
            --text-secondary: #c0c0c0;
            --text-meta: #888888;
            --header-gradient-1: #1e3a8a;
            --header-gradient-2: #1e40af;
            --border-color: #2d2d2d;
            --accent-color: #60a5fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-color);
            padding-bottom: 70px;
            transition: background 0.3s ease, color 0.3s ease;
            color: var(--text-primary);
        }
        
        /* === Header === */
        header {
            background: linear-gradient(135deg, var(--header-gradient-1), var(--header-gradient-2));
            color: #fff;
            padding: 0.8rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 12px rgba(59, 130, 246, 0.25);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-left { display: flex; align-items: center; }
        
        .menu-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            padding: 0.5rem;
            margin-right: 0.8rem;
            border-radius: 8px;
            transition: 0.2s;
        }
        
        .menu-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.03);
        }
        
        .header-center {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .logo-text { display: flex; align-items: center; }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: 0.2s;
        }
        
        .header-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.05);
        }
        
        /* === Sidebar === */
        .sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100%;
            background: var(--card-bg);
            box-shadow: var(--shadow-lg);
            z-index: 200;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .sidebar.open { left: 0; }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            border-radius: 8px;
            transition: 0.2s;
        }
        
        .close-btn:hover {
            background: var(--header-gradient-2);
            transform: rotate(90deg);
        }
        
        .sidebar-section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-meta);
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }
        
        .lang-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .lang-btn {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.7rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: 0.2s;
            text-align: center;
        }
        
        .lang-btn:hover {
            border-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .lang-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            font-weight: 600;
        }
        
        .theme-toggle {
            display: flex;
            gap: 0.5rem;
        }
        
        .theme-btn {
            flex: 1;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.7rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: 0.2s;
        }
        
        .theme-btn:hover {
            border-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .theme-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 150;
            display: none;
        }
        
        .overlay.show { display: block; }
        
        /* === Bottom Navigation === */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 0.8rem 0;
            box-shadow: 0 -2px 12px rgba(0,0,0,0.1);
            z-index: 90;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.2rem;
            color: var(--text-meta);
            text-decoration: none;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            padding: 0.3rem 1rem;
            border-radius: 8px;
        }
        
        .nav-item:hover, .nav-item.active {
            color: var(--accent-color);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .nav-icon { font-size: 1.5rem; }
        
        /* === Main Content === */
        .content {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* === News Cards === */
        .news-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .news-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: 0.2s;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }
        
        .news-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .news-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .news-content {
            padding: 1rem;
        }
        
        .news-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .news-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.8rem;
        }
        
        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-meta);
        }
        
        .news-source { font-weight: 500; }
        
        /* === Reels === */
        .reels-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            height: 75vh;
            margin: 0 auto;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .reel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
        }
        
        .reel.active { display: flex; }
        
        .reel img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .reel-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 2rem 1.5rem 1.5rem;
            color: white;
        }
        
        .reel-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }
        
        .reel-desc {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.8rem;
            opacity: 0.95;
        }
        
        .reel-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            opacity: 0.8;
        }
        
        .reel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 1rem 0.8rem;
            border-radius: 50%;
            backdrop-filter: blur(10px);
            transition: 0.2s;
            z-index: 10;
        }
        
        .reel-nav:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.1);
        }
        
        .reel-nav.prev { left: 1rem; }
        .reel-nav.next { right: 1rem; }
        
        .reel-counter {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        
        /* === Search === */
        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.9rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .search-btn:hover {
            background: var(--header-gradient-2);
            transform: scale(1.02);
        }
        
        /* === Bookmarks === */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-meta);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* === Loading === */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-meta);
            font-size: 1rem;
        }
        
        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* === Responsive === */
        @media (max-width: 480px) {
            .header-center { font-size: 1.3rem; }
            .page-title { font-size: 1.5rem; }
            .news-card img { height: 180px; }
            .reels-container { height: 70vh; }
        }
        
        /* === About Page === */
        .about-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .about-section h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .about-section p {
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 0.8rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .info-item {
            background: rgba(59, 130, 246, 0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .info-label {
            font-size: 0.75rem;
            color: var(--text-meta);
            margin-bottom: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-left">
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="header-center">
                <span class="logo-text">‚ö° Updates</span>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="window.location.reload()">üîÑ</button>
        </div>
    </header>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Settings</span>
            <button class="close-btn" onclick="toggleSidebar()">√ó</button>
        </div>
        
        <div class="sidebar-section">
            <div class="section-title">Language</div>
            <div class="lang-grid">
                <button class="lang-btn active" onclick="changeLanguage('en')">üá¨üáß English</button>
                <button class="lang-btn" onclick="changeLanguage('hi')">üáÆüá≥ Hindi</button>
                <button class="lang-btn" onclick="changeLanguage('es')">üá™üá∏ Spanish</button>
                <button class="lang-btn" onclick="changeLanguage('fr')">üá´üá∑ French</button>
                <button class="lang-btn" onclick="changeLanguage('de')">üá©üá™ German</button>
                <button class="lang-btn" onclick="changeLanguage('ar')">üá∏üá¶ Arabic</button>
                <button class="lang-btn" onclick="changeLanguage('pt')">üáßüá∑ Portuguese</button>
                <button class="lang-btn" onclick="changeLanguage('ja')">üáØüáµ Japanese</button>
                <button class="lang-btn" onclick="changeLanguage('zh')">üá®üá≥ Chinese</button>
                <button class="lang-btn" onclick="changeLanguage('ru')">üá∑üá∫ Russian</button>
                <button class="lang-btn" onclick="changeLanguage('it')">üáÆüáπ Italian</button>
                <button class="lang-btn" onclick="changeLanguage('ko')">üá∞üá∑ Korean</button>
            </div>
        </div>
        
        <div class="sidebar-section">
            <div class="section-title">Theme</div>
            <div class="theme-toggle">
                <button class="theme-btn active" onclick="setTheme('light')">‚òÄÔ∏è Light</button>
                <button class="theme-btn" onclick="setTheme('dark')">üåô Dark</button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Main Content -->
    <div class="content">
        <!-- Home Page -->
        <div class="page active" id="homePage">
            <h1 class="page-title">üè† Trending News</h1>
            <div class="loading" id="homeLoader">
                <div class="spinner"></div>
                Loading latest news...
            </div>
            <div class="news-list" id="newsList"></div>
        </div>

        <!-- Reels Page -->
        <div class="page" id="reelsPage">
            <h1 class="page-title">‚ö° Quick News</h1>
            <div class="loading" id="reelsLoader">
                <div class="spinner"></div>
                Loading quick news...
            </div>
            <div class="reels-container" id="reelsContainer"></div>
        </div>

        <!-- Search Page -->
        <div class="page" id="searchPage">
            <h1 class="page-title">üîç Search News</h1>
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="Search for news...">
                <button class="search-btn" onclick="searchNews()">Search</button>
            </div>
            <div class="news-list" id="searchResults"></div>
        </div>

        <!-- Bookmarks Page -->
        <div class="page" id="bookmarksPage">
            <h1 class="page-title">üìå Saved Articles</h1>
            <div class="news-list" id="bookmarksList"></div>
        </div>

        <!-- About Page -->
        <div class="page" id="aboutPage">
            <h1 class="page-title">‚ÑπÔ∏è About Updates</h1>
            
            <div class="about-section">
                <h2>üì∞ What is Updates?</h2>
                <p>Updates is a next-generation news aggregation platform engineered to deliver breaking news from around the world with unparalleled speed, accuracy, and user experience.</p>
            </div>
            
            <div class="about-section">
                <h2>üéØ Features</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Developer</div>
                        <div class="info-value">VIC Team</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Version</div>
                        <div class="info-value">1.0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Backend APIs</div>
                        <div class="info-value">5 Sources</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Languages</div>
                        <div class="info-value">12 Global</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Update Frequency</div>
                        <div class="info-value">30 Minutes</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Security</div>
                        <div class="info-value">‚úÖ Secure</div>
                    </div>
                </div>
            </div>
            
            <div class="about-section">
                <h2>üåê Our Mission</h2>
                <p>To democratize access to trustworthy, real-time global news while respecting user privacy and delivering an exceptional reading experience across all devices and languages.</p>
            </div>
            
            <div class="about-section">
                <h2>üí¨ Contact & Support</h2>
                <p>Need assistance? Our dedicated support team is here to help you with any questions or concerns.</p>
                <p style="margin-top: 1rem;">üìß Email: support@updatesnews.com<br>‚è±Ô∏è Response within 24-48 hours</p>
            </div>
            
            <div class="about-section">
                <p style="text-align: center; font-style: italic; color: var(--text-meta);">
                    Built with ‚ù§Ô∏è by news enthusiasts, for news enthusiasts who value speed, accuracy, privacy, and global perspective.
                </p>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a class="nav-item active" onclick="navigateTo('home')">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </a>
        <a class="nav-item" onclick="navigateTo('reels')">
            <span class="nav-icon">‚ö°</span>
            <span>Quick</span>
        </a>
        <a class="nav-item" onclick="navigateTo('search')">
            <span class="nav-icon">üîç</span>
            <span>Search</span>
        </a>
        <a class="nav-item" onclick="navigateTo('bookmarks')">
            <span class="nav-icon">üìå</span>
            <span>Saved</span>
        </a>
        <a class="nav-item" onclick="navigateTo('about')">
            <span class="nav-icon">‚ÑπÔ∏è</span>
            <span>About</span>
        </a>
    </nav>

    <script>
        // ============================================
        // üîí SECURITY: XSS PROTECTION
        // ============================================
        
        /**
         * ‚úÖ SECURE: Sanitizes HTML to prevent XSS attacks
         * Removes dangerous characters and tags
         */
        function sanitizeHTML(str) {
            if (!str || typeof str !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/javascript:/gi, '')
                .replace(/on\w+=/gi, '');
        }

        /**
         * ‚úÖ SECURE: Validates and sanitizes URLs
         * Ensures URLs are safe to use
         */
        function sanitizeURL(url) {
            if (!url || typeof url !== 'string') return '#';
            // Remove javascript: and data: protocols
            if (url.match(/^(javascript|data|vbscript):/i)) return '#';
            // Ensure URL starts with http or https
            if (!url.match(/^https?:\/\//i)) return '#';
            return url.replace(/[<>'"]/g, '');
        }

        /**
         * ‚úÖ SECURE: Validates image URLs
         * Returns safe placeholder if invalid
         */
        function sanitizeImageURL(url) {
            if (!url || typeof url !== 'string' || url.length < 10) {
                return 'https://via.placeholder.com/800x400/3b82f6/ffffff?text=News+Image';
            }
            return sanitizeURL(url);
        }

        /**
         * ‚úÖ SECURE: Validates and sanitizes search input
         */
        function sanitizeSearchInput(input) {
            if (!input || typeof input !== 'string') return '';
            return input
                .trim()
                .replace(/[<>]/g, '')
                .replace(/javascript:/gi, '')
                .replace(/on\w+=/gi, '')
                .substring(0, 100); // Limit length
        }

        /**
         * ‚úÖ SECURE: Formats date safely
         */
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Recently';
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;
                return `${Math.floor(diffMins / 1440)}d ago`;
            } catch (e) {
                return 'Recently';
            }
        }

        // ============================================
        // üåê GLOBAL STATE
        // ============================================
        const API_BASE = 'https://backend-ml60.onrender.com/api';
        let currentLang = localStorage.getItem('language') || 'en';
        let currentReelIndex = 0;
        let reelsData = [];

        // ============================================
        // üì± NAVIGATION
        // ============================================
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(page + 'Page').classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            if (page === 'home') loadHome();
            if (page === 'reels') loadReels();
            if (page === 'bookmarks') loadBookmarks();
            
            window.scrollTo(0, 0);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        // ============================================
        // üé® THEME
        // ============================================
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.querySelectorAll('.theme-btn').forEach(btn => {
            if ((btn.textContent.includes('Light') && savedTheme === 'light') ||
                (btn.textContent.includes('Dark') && savedTheme === 'dark')) {
                btn.classList.add('active');
            }
        });

        // ============================================
        // üåç LANGUAGE
        // ============================================
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            loadHome();
            toggleSidebar();
        }

        // Initialize language
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const lang = this.getAttribute('onclick').match(/'(.+?)'/)[1];
                if (lang === currentLang) {
                    this.classList.add('active');
                }
            });
        });

        // ============================================
        // üì∞ HOME - LOAD NEWS
        // ============================================
        function showHomeLoader(show) {
            document.getElementById('homeLoader').style.display = show ? 'block' : 'none';
        }

        function showReelsLoader(show) {
            document.getElementById('reelsLoader').style.display = show ? 'block' : 'none';
        }

        async function loadHome() {
            const list = document.getElementById('newsList');
            const reels = document.getElementById('reelsContainer');
            
            showHomeLoader(true);
            showReelsLoader(true);
            
            try {
                const response = await fetch(`${API_BASE}/all?country=in&language=${currentLang}`);
                if (!response.ok) throw new Error('Network error');
                
                const articles = await response.json();
                renderHomeNews(articles);
                renderReels(articles);
                
            } catch (err) {
                console.error('Fetch Error:', err);
                list.textContent = 'Failed to load. Check connection.';
                reels.textContent = 'Failed to load reels.';
            } finally {
                showHomeLoader(false);
                showReelsLoader(false);
            }
        }

        /**
         * ‚úÖ SECURE: Renders home news with XSS protection
         */
        function renderHomeNews(articles) {
            const list = document.getElementById('newsList');
            
            if (!articles.home || !articles.home.length) {
                list.textContent = 'No news found for this language.';
                return;
            }
            
            // ‚úÖ SECURE: Clear container safely
            list.innerHTML = '';
            
            articles.home.forEach((article, index) => {
                // ‚úÖ SECURE: Create elements programmatically (safer than innerHTML)
                const card = document.createElement('div');
                card.className = 'news-card';
                card.onclick = function() {
                    const safeURL = sanitizeURL(article.url || article.link || '#');
                    if (safeURL !== '#') {
                        window.open(safeURL, '_blank', 'noopener,noreferrer');
                    }
                };
                
                // Image
                const img = document.createElement('img');
                img.src = sanitizeImageURL(article.urlToImage || article.img);
                img.alt = sanitizeHTML(article.title || 'News image');
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/800x400/3b82f6/ffffff?text=News+Image';
                };
                card.appendChild(img);
                
                // Content
                const content = document.createElement('div');
                content.className = 'news-content';
                
                // Title
                const title = document.createElement('div');
                title.className = 'news-title';
                title.textContent = sanitizeHTML(article.title || 'Untitled');
                content.appendChild(title);
                
                // Description
                const desc = document.createElement('div');
                desc.className = 'news-desc';
                desc.textContent = sanitizeHTML(article.description || article.content || 'No description available');
                content.appendChild(desc);
                
                // Meta
                const meta = document.createElement('div');
                meta.className = 'news-meta';
                
                const source = document.createElement('span');
                source.className = 'news-source';
                source.textContent = sanitizeHTML(article.source?.name || article.author || 'Unknown Source');
                meta.appendChild(source);
                
                const time = document.createElement('span');
                time.textContent = formatDate(article.publishedAt || article.date);
                meta.appendChild(time);
                
                content.appendChild(meta);
                card.appendChild(content);
                list.appendChild(card);
            });
        }

        // ============================================
        // ‚ö° REELS
        // ============================================
        function loadReels() {
            showReelsLoader(true);
            loadHome();
        }

        /**
         * ‚úÖ SECURE: Renders reels with XSS protection
         */
        function renderReels(articles) {
            const container = document.getElementById('reelsContainer');
            
            if (!articles.quick || !articles.quick.length) {
                container.textContent = 'No quick news available.';
                return;
            }
            
            reelsData = articles.quick;
            currentReelIndex = 0;
            
            // ‚úÖ SECURE: Clear container safely
            container.innerHTML = '';
            
            reelsData.forEach((article, idx) => {
                const reel = document.createElement('div');
                reel.className = 'reel';
                reel.dataset.idx = idx;
                if (idx === 0) reel.classList.add('active');
                
                // Image
                const img = document.createElement('img');
                img.src = sanitizeImageURL(article.urlToImage || article.img);
                img.alt = sanitizeHTML(article.title || 'News image');
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/400x600/1e3a8a/ffffff?text=Quick+News';
                };
                reel.appendChild(img);
                
                // Content overlay
                const content = document.createElement('div');
                content.className = 'reel-content';
                content.onclick = function(e) {
                    e.stopPropagation();
                    const safeURL = sanitizeURL(article.url || article.link || '#');
                    if (safeURL !== '#') {
                        window.open(safeURL, '_blank', 'noopener,noreferrer');
                    }
                };
                
                // Title
                const title = document.createElement('div');
                title.className = 'reel-title';
                title.textContent = sanitizeHTML(article.title || 'Untitled');
                content.appendChild(title);
                
                // Description
                const desc = document.createElement('div');
                desc.className = 'reel-desc';
                desc.textContent = sanitizeHTML(article.description || article.content || 'No description');
                content.appendChild(desc);
                
                // Meta
                const meta = document.createElement('div');
                meta.className = 'reel-meta';
                
                const source = document.createElement('span');
                source.textContent = sanitizeHTML(article.source?.name || article.author || 'Unknown');
                meta.appendChild(source);
                
                const time = document.createElement('span');
                time.textContent = formatDate(article.publishedAt || article.date);
                meta.appendChild(time);
                
                content.appendChild(meta);
                reel.appendChild(content);
                container.appendChild(reel);
            });
            
            // Add navigation buttons
            if (reelsData.length > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'reel-nav prev';
                prevBtn.textContent = '‚óÄ';
                prevBtn.onclick = () => changeReel(-1);
                container.appendChild(prevBtn);
                
                const nextBtn = document.createElement('button');
                nextBtn.className = 'reel-nav next';
                nextBtn.textContent = '‚ñ∂';
                nextBtn.onclick = () => changeReel(1);
                container.appendChild(nextBtn);
                
                const counter = document.createElement('div');
                counter.className = 'reel-counter';
                counter.id = 'reelCounter';
                counter.textContent = `1 / ${reelsData.length}`;
                container.appendChild(counter);
            }
        }

        function changeReel(direction) {
            const reels = document.querySelectorAll('.reel');
            reels[currentReelIndex].classList.remove('active');
            
            currentReelIndex = (currentReelIndex + direction + reelsData.length) % reelsData.length;
            
            reels[currentReelIndex].classList.add('active');
            document.getElementById('reelCounter').textContent = `${currentReelIndex + 1} / ${reelsData.length}`;
        }

        // Keyboard navigation for reels
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('reelsPage').classList.contains('active')) {
                if (e.key === 'ArrowLeft') changeReel(-1);
                if (e.key === 'ArrowRight') changeReel(1);
            }
        });

        // Touch swipe for reels
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            if (document.getElementById('reelsPage').classList.contains('active')) {
                touchEndX = e.changedTouches[0].screenX;
                if (touchStartX - touchEndX > 50) changeReel(1);
                if (touchEndX - touchStartX > 50) changeReel(-1);
            }
        });

        // ============================================
        // üîç SEARCH
        // ============================================
        async function searchNews() {
            const query = document.getElementById('searchInput').value;
            const list = document.getElementById('searchResults');
            
            // ‚úÖ SECURE: Validate and sanitize input
            const safeQuery = sanitizeSearchInput(query);
            
            if (!safeQuery || safeQuery.length < 2) {
                list.textContent = 'Please enter at least 2 characters.';
                return;
            }
            
            list.innerHTML = '<div class="loading"><div class="spinner"></div>Searching...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(safeQuery)}&language=${currentLang}`);
                if (!response.ok) throw new Error('Search failed');
                
                const data = await response.json();
                renderSearchResults(data.articles || []);
                
            } catch (err) {
                console.error('Search Error:', err);
                list.textContent = 'Search failed. Please try again.';
            }
        }

        /**
         * ‚úÖ SECURE: Renders search results with XSS protection
         */
        function renderSearchResults(results) {
            const list = document.getElementById('searchResults');
            
            if (!results || !results.length) {
                list.textContent = 'No matches found.';
                return;
            }
            
            // ‚úÖ SECURE: Clear container safely
            list.innerHTML = '';
            
            results.forEach(article => {
                const card = document.createElement('div');
                card.className = 'news-card';
                card.onclick = function() {
                    const safeURL = sanitizeURL(article.url || article.link || '#');
                    if (safeURL !== '#') {
                        window.open(safeURL, '_blank', 'noopener,noreferrer');
                    }
                };
                
                const content = document.createElement('div');
                content.className = 'news-content';
                
                const title = document.createElement('div');
                title.className = 'news-title';
                title.textContent = sanitizeHTML(article.title || 'Untitled');
                content.appendChild(title);
                
                const desc = document.createElement('div');
                desc.className = 'news-desc';
                desc.textContent = sanitizeHTML(article.description || article.content || 'No description');
                content.appendChild(desc);
                
                const meta = document.createElement('div');
                meta.className = 'news-meta';
                
                const source = document.createElement('span');
                source.className = 'news-source';
                source.textContent = sanitizeHTML(article.source?.name || 'Unknown');
                meta.appendChild(source);
                
                const time = document.createElement('span');
                time.textContent = formatDate(article.publishedAt || article.date);
                meta.appendChild(time);
                
                content.appendChild(meta);
                card.appendChild(content);
                list.appendChild(card);
            });
        }

        // Allow search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchNews();
        });

        // ============================================
        // üìå BOOKMARKS
        // ============================================
        function loadBookmarks() {
            const list = document.getElementById('bookmarksList');
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            if (!bookmarks.length) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìå</div><p>Empty. Save articles to see them here.</p></div>';
                return;
            }
            
            // ‚úÖ SECURE: Render bookmarks safely
            list.innerHTML = '';
            
            bookmarks.forEach(article => {
                const card = document.createElement('div');
                card.className = 'news-card';
                card.onclick = function() {
                    const safeURL = sanitizeURL(article.url || '#');
                    if (safeURL !== '#') {
                        window.open(safeURL, '_blank', 'noopener,noreferrer');
                    }
                };
                
                const content = document.createElement('div');
                content.className = 'news-content';
                
                const title = document.createElement('div');
                title.className = 'news-title';
                title.textContent = sanitizeHTML(article.title || 'Untitled');
                content.appendChild(title);
                
                const desc = document.createElement('div');
                desc.className = 'news-desc';
                desc.textContent = sanitizeHTML(article.description || 'No description');
                content.appendChild(desc);
                
                const meta = document.createElement('div');
                meta.className = 'news-meta';
                
                const source = document.createElement('span');
                source.className = 'news-source';
                source.textContent = sanitizeHTML(article.source || 'Unknown');
                meta.appendChild(source);
                
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'üóëÔ∏è Remove';
                removeBtn.style.cssText = 'background:none;border:none;color:var(--accent-color);cursor:pointer;font-size:0.9rem;';
                removeBtn.onclick = function(e) {
                    e.stopPropagation();
                    removeBookmark(article.url);
                };
                meta.appendChild(removeBtn);
                
                content.appendChild(meta);
                card.appendChild(content);
                list.appendChild(card);
            });
        }

        function removeBookmark(url) {
            let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            bookmarks = bookmarks.filter(b => b.url !== url);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            loadBookmarks();
        }

        // ============================================
        // üöÄ INITIALIZE APP
        // ============================================
        window.addEventListener('DOMContentLoaded', () => {
            loadHome();
            console.log('‚úÖ Updates News App v1.0 - Loaded Successfully');
            console.log('üîí Security: XSS Protection Enabled');
            console.log('üåê Language:', currentLang);
        });
    </script>
</body>
</html>
