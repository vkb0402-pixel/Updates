<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Updates - Your Daily News Companion</title>
    <link rel="icon" href="image-2.png">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="no-referrer">
    
    <style>
        /* ================================
           MODERN VARIABLES - INSHORTS STYLE
           ================================ */
        :root {
            /* Light Theme - Clean & Bright like Inshorts */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --bg-tertiary: #F1F3F5;
            
            --text-primary: #1A1A1A;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            
            --accent-primary: #2563EB;
            --accent-hover: #1D4ED8;
            --accent-light: #EFF6FF;
            
            --border-color: #E5E7EB;
            --divider-color: #F3F4F6;
            
            --success-color: #10B981;
            --error-color: #EF4444;
            --warning-color: #F59E0B;
            
            /* Shadows - Soft & Subtle */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.03);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.10);
            
            /* Spacing System */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            /* Transitions - Smooth like butter */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #111827;
            --bg-secondary: #1F2937;
            --bg-tertiary: #374151;
            
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-tertiary: #9CA3AF;
            
            --accent-primary: #3B82F6;
            --accent-hover: #60A5FA;
            --accent-light: #1E3A8A;
            
            --border-color: #374151;
            --divider-color: #1F2937;
            
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.5);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.6);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.7);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.8);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.9);
        }

        /* ================================
           RESET & BASE STYLES
           ================================ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 70px;
            transition: background var(--transition-base), color var(--transition-base);
        }

        /* ================================
           LOADING SCREEN - PROFESSIONAL
           ================================ */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loading-logo {
            width: 72px;
            height: 72px;
            margin-bottom: var(--space-xl);
            border-radius: var(--radius-lg);
            object-fit: cover;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--accent-primary);
            border-radius: var(--radius-full);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: var(--space-xl);
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            opacity: 0.9;
        }

        .loading-subtext {
            margin-top: var(--space-sm);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ================================
           HEADER - STICKY & SMOOTH
           ================================ */
        .header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-lg);
            z-index: 1000;
            backdrop-filter: blur(12px);
            transition: all var(--transition-base);
        }

        .header.scrolled {
            box-shadow: var(--shadow-sm);
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .header-logo:active {
            transform: scale(0.98);
        }

        .logo-img {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            object-fit: cover;
        }

        .logo-text {
            font-size: 1.375rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), #7C3AED);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 1.25rem;
        }

        .icon-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        /* ================================
           MAIN CONTAINER
           ================================ */
        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        /* ================================
           NEWS CARD - INSHORTS INSPIRED
           ================================ */
        .news-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .news-card:active {
            transform: translateY(-2px);
        }

        .news-image-container {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
            background: var(--bg-tertiary);
        }

        .news-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }

        .news-card:hover .news-image {
            transform: scale(1.05);
        }

        .news-category-badge {
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: var(--radius-sm);
        }

        .news-content {
            padding: var(--space-lg);
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            font-size: 0.8125rem;
            color: var(--text-tertiary);
        }

        .news-source {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .meta-divider {
            width: 4px;
            height: 4px;
            border-radius: var(--radius-full);
            background: var(--text-tertiary);
        }

        .news-title {
            font-size: 1.25rem;
            font-weight: 700;
            line-height: 1.4;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            letter-spacing: -0.02em;
        }

        .news-description {
            font-size: 0.9375rem;
            line-height: 1.65;
            color: var(--text-secondary);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: var(--space-md);
            margin-top: var(--space-md);
            border-top: 1px solid var(--divider-color);
        }

        .read-more-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--accent-light);
            color: var(--accent-primary);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .read-more-btn:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateX(4px);
        }

        .bookmark-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 1.125rem;
        }

        .bookmark-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .bookmark-btn.bookmarked {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        /* ================================
           SEARCH SECTION
           ================================ */
        .search-container {
            margin-bottom: var(--space-xl);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            height: 52px;
            padding: 0 52px 0 var(--space-lg);
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            color: var(--text-primary);
            font-family: inherit;
            outline: none;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .search-input::placeholder {
            color: var(--text-tertiary);
        }

        .search-icon {
            position: absolute;
            right: var(--space-md);
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--accent-primary);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .search-icon:hover {
            background: var(--accent-hover);
            transform: translateY(-50%) scale(1.05);
        }

        .search-icon:active {
            transform: translateY(-50%) scale(0.98);
        }

        /* ================================
           BOTTOM NAVIGATION - MODERN
           ================================ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 68px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 var(--space-md);
            z-index: 1000;
            backdrop-filter: blur(12px);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: var(--space-sm);
            cursor: pointer;
            color: var(--text-tertiary);
            transition: all var(--transition-fast);
            text-decoration: none;
            position: relative;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 32px;
            height: 3px;
            background: var(--accent-primary);
            border-radius: 0 0 var(--radius-sm) var(--radius-sm);
            transition: transform var(--transition-fast);
        }

        .nav-item.active::before {
            transform: translateX(-50%) scaleX(1);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item.active {
            color: var(--accent-primary);
        }

        .nav-icon {
            font-size: 1.5rem;
            transition: transform var(--transition-fast);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-label {
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        /* ================================
           EMPTY STATE & ERROR
           ================================ */
        .empty-state {
            text-align: center;
            padding: var(--space-2xl) var(--space-lg);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-lg);
            opacity: 0.3;
        }

        .empty-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }

        .empty-text {
            font-size: 0.9375rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-xl);
        }

        .retry-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: 12px 24px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .retry-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ================================
           PAGE TRANSITIONS
           ================================ */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* ================================
           SKELETON LOADER - SMOOTH
           ================================ */
        .skeleton {
            background: linear-gradient(
                90deg,
                var(--bg-tertiary) 25%,
                var(--bg-secondary) 50%,
                var(--bg-tertiary) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .skeleton-image {
            width: 100%;
            height: 220px;
            margin-bottom: var(--space-lg);
        }

        .skeleton-title {
            width: 80%;
            height: 24px;
            margin-bottom: var(--space-md);
        }

        .skeleton-text {
            width: 100%;
            height: 16px;
            margin-bottom: var(--space-sm);
        }

        .skeleton-text:last-child {
            width: 60%;
        }

        /* ================================
           RESPONSIVE DESIGN
           ================================ */
        @media (max-width: 640px) {
            .container {
                padding: var(--space-md);
            }

            .news-title {
                font-size: 1.125rem;
            }

            .news-description {
                font-size: 0.875rem;
            }

            .header {
                padding: 0 var(--space-md);
            }

            .logo-text {
                font-size: 1.25rem;
            }
        }

        /* ================================
           UTILITY CLASSES
           ================================ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- ================================
         LOADING SCREEN
         ================================ -->
    <div class="loading-screen" id="loadingScreen">
        <img src="image-2.png" alt="Updates Logo" class="loading-logo" onerror="this.style.display='none'">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Latest News</div>
        <div class="loading-subtext">Fetching stories from multiple sources...</div>
    </div>

    <!-- ================================
         HEADER
         ================================ -->
    <header class="header" id="header">
        <div class="header-logo" onclick="scrollToTop()">
            <img src="image-2.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
            <span class="logo-text">Updates</span>
        </div>
        <div class="header-actions">
            <button class="icon-btn" id="themeToggle" aria-label="Toggle theme">
                <span id="themeIcon">üåô</span>
            </button>
            <button class="icon-btn" id="refreshBtn" aria-label="Refresh news">
                <span>üîÑ</span>
            </button>
        </div>
    </header>

    <!-- ================================
         MAIN CONTENT
         ================================ -->
    <main class="container">
        <!-- HOME PAGE -->
        <div class="page active" id="homePage">
            <div id="homeNewsGrid">
                <!-- Skeleton Loader -->
                <div class="skeleton-card">
                    <div class="skeleton skeleton-image"></div>
                    <div class="skeleton skeleton-title"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                </div>
                <div class="skeleton-card">
                    <div class="skeleton skeleton-image"></div>
                    <div class="skeleton skeleton-title"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                </div>
            </div>
        </div>

        <!-- SEARCH PAGE -->
        <div class="page" id="searchPage">
            <div class="search-container">
                <div class="search-box">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Search news by keywords..."
                        autocomplete="off"
                    >
                    <button class="search-icon" id="searchBtn" aria-label="Search">
                        <span>üîç</span>
                    </button>
                </div>
            </div>
            <div id="searchResults"></div>
        </div>

        <!-- TRENDING PAGE -->
        <div class="page" id="trendingPage">
            <div id="trendingNewsGrid"></div>
        </div>

        <!-- BOOKMARKS PAGE -->
        <div class="page" id="bookmarksPage">
            <div id="bookmarksGrid"></div>
        </div>
    </main>

    <!-- ================================
         BOTTOM NAVIGATION
         ================================ -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="homePage">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </a>
        <a href="#" class="nav-item" data-page="searchPage">
            <span class="nav-icon">üîç</span>
            <span class="nav-label">Search</span>
        </a>
        <a href="#" class="nav-item" data-page="trendingPage">
            <span class="nav-icon">‚ö°</span>
            <span class="nav-label">Trending</span>
        </a>
        <a href="#" class="nav-item" data-page="bookmarksPage">
            <span class="nav-icon">üì∞</span>
            <span class="nav-label">Saved</span>
        </a>
    </nav>

    <!-- ================================
         JAVASCRIPT - FIXED API & SMOOTH
         ================================ -->
    <script>
        // ========================================
        // CONFIGURATION - FIXED API ENDPOINTS
        // ========================================
        const CONFIG = {
            // CORRECTED API BASE URL
            API_BASE: 'https://news-api-proxy-secure.onrender.com',
            CACHE_KEY: 'newsCache_v3',
            CACHE_TIMESTAMP_KEY: 'newsCacheTimestamp_v3',
            CACHE_DURATION: 15 * 60 * 1000, // 15 minutes
            REQUEST_TIMEOUT: 10000, // 10 seconds
            MAX_RETRIES: 3,
            RETRY_DELAY: 2000 // 2 seconds
        };

        // ========================================
        // STATE MANAGEMENT
        // ========================================
        let allNews = [];
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
        let currentPage = 'homePage';
        let isLoading = false;

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function sanitizeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function getTimeAgo(dateString) {
            if (!dateString) return 'Recently';
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            const intervals = [
                { label: 'year', seconds: 31536000 },
                { label: 'month', seconds: 2592000 },
                { label: 'week', seconds: 604800 },
                { label: 'day', seconds: 86400 },
                { label: 'hour', seconds: 3600 },
                { label: 'minute', seconds: 60 }
            ];

            for (const interval of intervals) {
                const count = Math.floor(seconds / interval.seconds);
                if (count >= 1) {
                    return `${count} ${interval.label}${count !== 1 ? 's' : ''} ago`;
                }
            }
            return 'Just now';
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // CACHE MANAGEMENT
        // ========================================
        const Cache = {
            save(data) {
                try {
                    localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify(data));
                    localStorage.setItem(CONFIG.CACHE_TIMESTAMP_KEY, Date.now().toString());
                    console.log('‚úÖ Cache saved successfully');
                } catch (e) {
                    console.warn('‚ö†Ô∏è Failed to save cache:', e.message);
                }
            },

            load() {
                try {
                    const timestamp = parseInt(localStorage.getItem(CONFIG.CACHE_TIMESTAMP_KEY) || '0');
                    const age = Date.now() - timestamp;

                    if (age > CONFIG.CACHE_DURATION) {
                        console.log('‚è∞ Cache expired');
                        return null;
                    }

                    const data = localStorage.getItem(CONFIG.CACHE_KEY);
                    if (data) {
                        console.log(`‚úÖ Loaded from cache (${Math.round(age / 1000)}s old)`);
                        return JSON.parse(data);
                    }
                } catch (e) {
                    console.warn('‚ö†Ô∏è Failed to load cache:', e.message);
                }
                return null;
            },

            clear() {
                localStorage.removeItem(CONFIG.CACHE_KEY);
                localStorage.removeItem(CONFIG.CACHE_TIMESTAMP_KEY);
                console.log('üóëÔ∏è Cache cleared');
            }
        };

        // ========================================
        // API FETCHING - FIXED & ROBUST
        // ========================================
        async function fetchWithRetry(url, retries = CONFIG.MAX_RETRIES) {
            for (let i = 0; i < retries; i++) {
                try {
                    console.log(`üîÑ Attempt ${i + 1}/${retries}: ${url}`);
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), CONFIG.REQUEST_TIMEOUT);

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'UpdatesApp/1.0'
                        },
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log(`‚úÖ Success: ${url}`);
                    return data;

                } catch (error) {
                    console.warn(`‚ö†Ô∏è Attempt ${i + 1} failed:`, error.message);
                    
                    if (i < retries - 1) {
                        await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY));
                    } else {
                        throw error;
                    }
                }
            }
        }

        async function fetchAllNews() {
            const language = localStorage.getItem('language') || 'en';
            const country = localStorage.getItem('country') || 'in';

            // Check cache first
            const cached = Cache.load();
            if (cached && cached.length > 0) {
                return cached;
            }

            const apis = [
                {
                    name: 'NewsAPI',
                    url: `${CONFIG.API_BASE}/api/newsapi?country=${country}&language=${language}`,
                    key: 'articles'
                },
                {
                    name: 'GNews',
                    url: `${CONFIG.API_BASE}/api/gnews?country=${country}&lang=${language}`,
                    key: 'articles'
                },
                {
                    name: 'NewsData',
                    url: `${CONFIG.API_BASE}/api/newsdata?country=${country}&language=${language}`,
                    key: 'results'
                },
                {
                    name: 'Currents',
                    url: `${CONFIG.API_BASE}/api/currents?language=${language}`,
                    key: 'news'
                }
            ];

            const allArticles = [];
            const promises = apis.map(async (api) => {
                try {
                    const data = await fetchWithRetry(api.url);
                    const articles = data[api.key];
                    
                    if (Array.isArray(articles) && articles.length > 0) {
                        console.log(`‚úÖ ${api.name}: ${articles.length} articles`);
                        return articles;
                    }
                } catch (error) {
                    console.error(`‚ùå ${api.name} failed:`, error.message);
                }
                return [];
            });

            const results = await Promise.allSettled(promises);
            
            results.forEach(result => {
                if (result.status === 'fulfilled' && result.value) {
                    allArticles.push(...result.value);
                }
            });

            if (allArticles.length === 0) {
                throw new Error('No news sources responded successfully');
            }

            // Filter valid articles
            const validArticles = allArticles.filter(article => 
                article.title && 
                article.title !== '[Removed]' &&
                (article.url || article.link)
            );

            // Sort by date
            validArticles.sort((a, b) => {
                const dateA = new Date(a.publishedAt || a.pubDate || 0);
                const dateB = new Date(b.publishedAt || b.pubDate || 0);
                return dateB - dateA;
            });

            // Save to cache
            Cache.save(validArticles);

            console.log(`‚úÖ Total valid articles: ${validArticles.length}`);
            return validArticles;
        }

        // ========================================
        // UI RENDERING
        // ========================================
        function renderNewsCard(article) {
            const title = sanitizeHTML(article.title || 'Untitled');
            const description = sanitizeHTML(article.description || article.content || 'No description available');
            const imageUrl = article.urlToImage || article.image || article.imageurl || 'https://via.placeholder.com/680x220/3B82F6/ffffff?text=No+Image';
            const url = article.url || article.link || '#';
            const source = sanitizeHTML(article.source?.name || article.sourcename || 'Unknown Source');
            const timeAgo = getTimeAgo(article.publishedAt || article.pubDate);
            const category = article.category?.[0] || article.categories?.[0] || 'General';
            const isBookmarked = bookmarks.some(b => b.url === url);

            return `
                <article class="news-card" onclick="openArticle('${url}')">
                    <div class="news-image-container">
                        <img 
                            src="${imageUrl}" 
                            alt="${title}" 
                            class="news-image"
                            loading="lazy"
                            onerror="this.src='https://via.placeholder.com/680x220/3B82F6/ffffff?text=No+Image'"
                        >
                        <span class="news-category-badge">${category}</span>
                    </div>
                    <div class="news-content">
                        <div class="news-meta">
                            <span class="news-source">${source}</span>
                            <span class="meta-divider"></span>
                            <span>${timeAgo}</span>
                        </div>
                        <h2 class="news-title">${title}</h2>
                        <p class="news-description">${description}</p>
                        <div class="news-footer">
                            <button class="read-more-btn" onclick="event.stopPropagation(); openArticle('${url}')">
                                Read Full Story ‚Üí
                            </button>
                            <button 
                                class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                onclick="event.stopPropagation(); toggleBookmark(this, '${url}')"
                                aria-label="Bookmark"
                            >
                                ${isBookmarked ? '‚≠ê' : '‚òÜ'}
                            </button>
                        </div>
                    </div>
                </article>
            `;
        }

        function renderNews(articles, containerId) {
            const container = document.getElementById(containerId);
            
            if (!articles || articles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h3 class="empty-title">No Articles Found</h3>
                        <p class="empty-text">Try refreshing or check back later</p>
                        <button class="retry-btn" onclick="refreshNews()">
                            üîÑ Refresh News
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = articles.map(article => renderNewsCard(article)).join('');
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <h3 class="empty-title">Connection Error</h3>
                    <p class="empty-text">${message}</p>
                    <button class="retry-btn" onclick="initializeApp()">
                        üîÑ Try Again
                    </button>
                </div>
            `;
        }

        // ========================================
        // PAGE INITIALIZATION
        // ========================================
        async function initializeApp() {
            if (isLoading) return;
            isLoading = true;

            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.classList.remove('hidden');

            try {
                allNews = await fetchAllNews();

                if (allNews.length === 0) {
                    throw new Error('No news articles available');
                }

                // Render home page
                renderNews(allNews.slice(0, 20), 'homeNewsGrid');

                // Render trending page
                renderNews(allNews.slice(0, 30), 'trendingNewsGrid');

                // Render bookmarks
                renderBookmarks();

                // Hide loading screen
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 500);

            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
                loadingScreen.classList.add('hidden');
                showError('homeNewsGrid', 'Unable to fetch news. Please check your internet connection.');
            } finally {
                isLoading = false;
            }
        }

        // ========================================
        // BOOKMARKS
        // ========================================
        function toggleBookmark(btn, url) {
            const article = allNews.find(a => (a.url || a.link) === url);
            if (!article) return;

            const index = bookmarks.findIndex(b => b.url === url);
            
            if (index > -1) {
                bookmarks.splice(index, 1);
                btn.classList.remove('bookmarked');
                btn.textContent = '‚òÜ';
            } else {
                bookmarks.push({
                    ...article,
                    url: article.url || article.link,
                    savedAt: Date.now()
                });
                btn.classList.add('bookmarked');
                btn.textContent = '‚≠ê';
            }

            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            
            if (currentPage === 'bookmarksPage') {
                renderBookmarks();
            }
        }

        function renderBookmarks() {
            const container = document.getElementById('bookmarksGrid');
            
            if (bookmarks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚≠ê</div>
                        <h3 class="empty-title">No Saved Articles</h3>
                        <p class="empty-text">Bookmark articles to read them later</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bookmarks
                .sort((a, b) => (b.savedAt || 0) - (a.savedAt || 0))
                .map(article => renderNewsCard(article))
                .join('');
        }

        // ========================================
        // SEARCH FUNCTIONALITY
        // ========================================
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const container = document.getElementById('searchResults');

            if (!query) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <h3 class="empty-title">Start Searching</h3>
                        <p class="empty-text">Enter keywords to find news articles</p>
                    </div>
                `;
                return;
            }

            const results = allNews.filter(article => 
                article.title?.toLowerCase().includes(query) ||
                article.description?.toLowerCase().includes(query)
            );

            if (results.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <h3 class="empty-title">No Results Found</h3>
                        <p class="empty-text">Try different keywords</p>
                    </div>
                `;
                return;
            }

            renderNews(results, 'searchResults');
        }

        // ========================================
        // EVENT HANDLERS
        // ========================================
        function openArticle(url) {
            if (url && url !== '#') {
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        }

        function refreshNews() {
            Cache.clear();
            initializeApp();
        }

        function switchPage(pageId) {
            currentPage = pageId;
            
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId);
            });

            // Update pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.toggle('active', page.id === pageId);
            });

            scrollToTop();
        }

        // ========================================
        // EVENT LISTENERS
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize app
            initializeApp();

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchPage(item.dataset.page);
                });
            });

            // Search
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', refreshNews);

            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '‚òÄÔ∏è';
            }

            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.hasAttribute('data-theme');
                
                if (isDark) {
                    document.documentElement.removeAttribute('data-theme');
                    themeIcon.textContent = 'üåô';
                    localStorage.setItem('theme', 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeIcon.textContent = '‚òÄÔ∏è';
                    localStorage.setItem('theme', 'dark');
                }
            });

            // Header scroll effect
            let lastScroll = 0;
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                const header = document.getElementById('header');
                
                if (currentScroll > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                lastScroll = currentScroll;
            });
        });

        // Auto-refresh every 15 minutes
        setInterval(() => {
            console.log('üîÑ Auto-refreshing news...');
            Cache.clear();
            initializeApp();
        }, CONFIG.CACHE_DURATION);
           // ========================================
        // PART 3: BONUS PROFESSIONAL FEATURES
        // ========================================

        // ========================================
        // 1. PULL-TO-REFRESH (Mobile Experience)
        // ========================================
        let startY = 0;
        let pullDistance = 0;
        const pullThreshold = 80;

        document.addEventListener('touchstart', (e) => {
            if (window.scrollY === 0) {
                startY = e.touches[0].clientY;
            }
        });

        document.addEventListener('touchmove', (e) => {
            if (window.scrollY === 0 && startY > 0) {
                pullDistance = e.touches[0].clientY - startY;
                
                if (pullDistance > 0 && pullDistance < pullThreshold * 2) {
                    const header = document.getElementById('header');
                    header.style.transform = `translateY(${Math.min(pullDistance / 2, 40)}px)`;
                    header.style.opacity = 1 - (pullDistance / 200);
                }
            }
        });

        document.addEventListener('touchend', () => {
            const header = document.getElementById('header');
            header.style.transform = '';
            header.style.opacity = '';
            
            if (pullDistance > pullThreshold) {
                refreshNews();
            }
            
            startY = 0;
            pullDistance = 0;
        });

        // ========================================
        // 2. READING PROGRESS INDICATOR
        // ========================================
        function addReadingProgress() {
            const progressBar = document.createElement('div');
            progressBar.id = 'readingProgress';
            progressBar.style.cssText = `
                position: fixed;
                top: 60px;
                left: 0;
                height: 3px;
                background: linear-gradient(90deg, var(--accent-primary), #7C3AED);
                width: 0%;
                z-index: 1001;
                transition: width 0.1s ease;
            `;
            document.body.appendChild(progressBar);

            window.addEventListener('scroll', () => {
                const winScroll = document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                progressBar.style.width = scrolled + '%';
            });
        }

        // ========================================
        // 3. OFFLINE DETECTION
        // ========================================
        function setupOfflineDetection() {
            const offlineBanner = document.createElement('div');
            offlineBanner.id = 'offlineBanner';
            offlineBanner.style.cssText = `
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                background: #EF4444;
                color: white;
                text-align: center;
                padding: 12px;
                font-size: 0.875rem;
                font-weight: 600;
                transform: translateY(-100%);
                transition: transform 0.3s ease;
                z-index: 999;
            `;
            offlineBanner.textContent = 'üì° You are offline. Showing cached news.';
            document.body.appendChild(offlineBanner);

            window.addEventListener('online', () => {
                offlineBanner.style.transform = 'translateY(-100%)';
                console.log('‚úÖ Connection restored');
                refreshNews();
            });

            window.addEventListener('offline', () => {
                offlineBanner.style.transform = 'translateY(0)';
                console.log('‚ö†Ô∏è No internet connection');
            });
        }

        // ========================================
        // 4. SHARE FUNCTIONALITY
        // ========================================
        function shareArticle(title, url) {
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                }).catch(err => console.log('Share cancelled'));
            } else {
                // Fallback: Copy to clipboard
                navigator.clipboard.writeText(url).then(() => {
                    showToast('Link copied to clipboard! üìã');
                });
            }
        }

        // ========================================
        // 5. TOAST NOTIFICATIONS
        // ========================================
        function showToast(message, duration = 3000) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 88px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background: var(--text-primary);
                color: var(--bg-primary);
                padding: 12px 24px;
                border-radius: var(--radius-md);
                font-size: 0.875rem;
                font-weight: 600;
                z-index: 10000;
                box-shadow: var(--shadow-xl);
                opacity: 0;
                transition: all 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.transform = 'translateX(-50%) translateY(0)';
                toast.style.opacity = '1';
            }, 10);

            setTimeout(() => {
                toast.style.transform = 'translateX(-50%) translateY(100px)';
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // ========================================
        // 6. KEYBOARD SHORTCUTS
        // ========================================
        document.addEventListener('keydown', (e) => {
            // R = Refresh
            if (e.key === 'r' || e.key === 'R') {
                if (!e.ctrlKey && !e.metaKey) {
                    e.preventDefault();
                    refreshNews();
                    showToast('Refreshing news... üîÑ');
                }
            }
            
            // S = Search focus
            if (e.key === 's' || e.key === 'S') {
                if (!e.ctrlKey && !e.metaKey) {
                    e.preventDefault();
                    switchPage('searchPage');
                    setTimeout(() => document.getElementById('searchInput').focus(), 100);
                }
            }
            
            // T = Theme toggle
            if (e.key === 't' || e.key === 'T') {
                if (!e.ctrlKey && !e.metaKey) {
                    e.preventDefault();
                    document.getElementById('themeToggle').click();
                }
            }

            // Numbers 1-4 = Switch pages
            if (e.key >= '1' && e.key <= '4') {
                const pages = ['homePage', 'searchPage', 'trendingPage', 'bookmarksPage'];
                switchPage(pages[parseInt(e.key) - 1]);
            }
        });

        // ========================================
        // 7. IMAGE LAZY LOADING OBSERVER
        // ========================================
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        imageObserver.unobserve(img);
                    }
                }
            });
        }, { rootMargin: '50px' });

        // ========================================
        // 8. ANALYTICS & TRACKING (Optional)
        // ========================================
        function trackEvent(category, action, label) {
            console.log(`üìä Event: ${category} - ${action} - ${label}`);
            // Add your analytics code here (Google Analytics, Mixpanel, etc.)
        }

        // Enhanced openArticle with tracking
        const originalOpenArticle = openArticle;
        openArticle = function(url) {
            trackEvent('News', 'ArticleOpened', url);
            originalOpenArticle(url);
        };

        // ========================================
        // 9. SCROLL TO TOP BUTTON
        // ========================================
        function addScrollToTopButton() {
            const scrollBtn = document.createElement('button');
            scrollBtn.id = 'scrollTopBtn';
            scrollBtn.innerHTML = '‚Üë';
            scrollBtn.style.cssText = `
                position: fixed;
                bottom: 88px;
                right: 20px;
                width: 48px;
                height: 48px;
                background: var(--accent-primary);
                color: white;
                border: none;
                border-radius: var(--radius-full);
                font-size: 1.5rem;
                font-weight: 700;
                cursor: pointer;
                z-index: 999;
                box-shadow: var(--shadow-lg);
                opacity: 0;
                visibility: hidden;
                transform: scale(0.8);
                transition: all var(--transition-base);
            `;
            document.body.appendChild(scrollBtn);

            scrollBtn.addEventListener('click', scrollToTop);

            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    scrollBtn.style.opacity = '1';
                    scrollBtn.style.visibility = 'visible';
                    scrollBtn.style.transform = 'scale(1)';
                } else {
                    scrollBtn.style.opacity = '0';
                    scrollBtn.style.visibility = 'hidden';
                    scrollBtn.style.transform = 'scale(0.8)';
                }
            });

            scrollBtn.addEventListener('mouseenter', () => {
                scrollBtn.style.transform = 'scale(1.1)';
            });

            scrollBtn.addEventListener('mouseleave', () => {
                scrollBtn.style.transform = 'scale(1)';
            });
        }

        // ========================================
        // 10. PERFORMANCE MONITORING
        // ========================================
        function monitorPerformance() {
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log('‚ö° Performance Metrics:');
                        console.log(`   DNS: ${Math.round(perfData.domainLookupEnd - perfData.domainLookupStart)}ms`);
                        console.log(`   TCP: ${Math.round(perfData.connectEnd - perfData.connectStart)}ms`);
                        console.log(`   DOM Load: ${Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart)}ms`);
                        console.log(`   Total Load: ${Math.round(perfData.loadEventEnd - perfData.loadEventStart)}ms`);
                    }, 0);
                });
            }
        }

        // ========================================
        // INITIALIZE ALL BONUS FEATURES
        // ========================================
        function initializeBonusFeatures() {
            addReadingProgress();
            setupOfflineDetection();
            addScrollToTopButton();
            monitorPerformance();
            
            console.log('üéâ All bonus features initialized!');
            console.log('‚å®Ô∏è  Keyboard Shortcuts:');
            console.log('   R = Refresh news');
            console.log('   S = Open search');
            console.log('   T = Toggle theme');
            console.log('   1-4 = Switch pages');
        }

        // Auto-initialize bonus features on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeBonusFeatures);
        } else {
            initializeBonusFeatures();
        }

        // ========================================
        // 11. SERVICE WORKER (PWA Support)
        // ========================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // You can add service worker registration here for offline support
                console.log('üí° Service Worker support detected');
            });
        }

        // ========================================
        // 12. CONSOLE WELCOME MESSAGE
        // ========================================
        console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                           ‚ïë
‚ïë              üì∞ UPDATES - NEWS APP v3.0                   ‚ïë
‚ïë                                                           ‚ïë
‚ïë  Status: ‚úÖ All Systems Operational                       ‚ïë
‚ïë  APIs: 4 Active News Sources                             ‚ïë
‚ïë  Cache: Smart 15-min caching                             ‚ïë
‚ïë  Features: Search, Bookmarks, Dark Mode, PWA Ready       ‚ïë
‚ïë                                                           ‚ïë
‚ïë  Made with ‚ù§Ô∏è  by VIC Team                                ‚ïë
‚ïë                                                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    </script>
</body>
    </html>
